@* --- Existing Global Modal --- *@
<div class="modal fade" id="globalModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" id="globalModalDialog">
        <div class="modal-content" id="globalModalContent">
            @* Content will be loaded via AJAX *@
        </div>
    </div>
</div>

@* --- Support Modal (Updated) --- *@
<div class="modal fade" id="supportModal" tabindex="-1" aria-labelledby="supportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supportModalLabel"><i class="bi bi-person-raised-hand me-2"></i>ศูนย์ช่วยเหลือ (Help Center)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs" id="supportTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="problem-tab" data-bs-toggle="tab" data-bs-target="#problem-tab-pane" type="button" role="tab" aria-controls="problem-tab-pane" aria-selected="true">
                            <i class="bi bi-exclamation-triangle-fill me-1"></i> แจ้งปัญหา
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="request-tab" data-bs-toggle="tab" data-bs-target="#request-tab-pane" type="button" role="tab" aria-controls="request-tab-pane" aria-selected="false">
                            <i class="bi bi-box-seam me-1"></i> เบิก/ขออุปกรณ์
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history-tab-pane" type="button" role="tab" aria-controls="history-tab-pane" aria-selected="false">
                            <i class="bi bi-clock-history me-1"></i> ประวัติของฉัน
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content pt-4" id="supportTabContent">
                    <!-- แจ้งปัญหา Tab Pane -->
                    <div class="tab-pane fade show active" id="problem-tab-pane" role="tabpanel" aria-labelledby="problem-tab" tabindex="0">
                        <h5 class="mb-3">แบบฟอร์มแจ้งปัญหา</h5>

                        @* --- NEW FORM --- *@
                        <form id="createTicketForm" asp-controller="Support" asp-action="Create" method="post" novalidate>
                            @Html.AntiForgeryToken()

                            <div class="form-floating mb-3">
                                <select id="ticketCategoryId" name="CategoryId" class="form-select" required>
                                    <option value="">กำลังโหลดข้อมูลหมวดหมู่...</option>
                                </select>
                                <label for="ticketCategoryId">หมวดหมู่ของปัญหา</label>
                                <div class="invalid-feedback">กรุณาเลือกหมวดหมู่</div>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="text" id="ticketTitle" name="Title" class="form-control" placeholder="หัวข้อ" required>
                                <label for="ticketTitle">หัวข้อ (เช่น: โปรแกรมบัญชีใช้งานไม่ได้, ขอรีเซ็ตรหัสผ่าน)</label>
                                <div class="invalid-feedback">กรุณาระบุหัวข้อ</div>
                            </div>

                            <div class="form-floating mb-3">
                                <textarea id="ticketDescription" name="Description" class="form-control" placeholder="รายละเอียด" style="height: 120px" required></textarea>
                                <label for="ticketDescription">รายละเอียด (โปรดอธิบายปัญหาให้ชัดเจนที่สุด)</label>
                                <div class="invalid-feedback">กรุณาระบุรายละเอียด</div>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select id="ticketPriority" name="Priority" asp-items="Html.GetEnumSelectList<Portal.Shared.Enums.Support.TicketPriority>()" class="form-select">
                                        </select>
                                        <label for="ticketPriority">ระดับความสำคัญ</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select id="ticketAssetId" name="AssetId" class="form-select">
                                            <option value="">ไม่มี</option>
                                            @* We can load user's assets here later *@
                                        </select>
                                        <label for="ticketAssetId">ทรัพย์สินที่เกี่ยวข้อง (ถ้ามี)</label>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </div>

                    <!-- เบิก/ขออุปกรณ์ Tab Pane -->
                    <div class="tab-pane fade" id="request-tab-pane" role="tabpanel" aria-labelledby="request-tab" tabindex="0">
                        <p class="text-center text-muted p-5">ส่วนนี้ยังอยู่ในระหว่างการพัฒนา</p>
                    </div>

                    <!-- ประวัติของฉัน Tab Pane -->
                    <div class="tab-pane fade" id="history-tab-pane" role="tabpanel" aria-labelledby="history-tab" tabindex="0">
                        <p class="text-center text-muted p-5">ส่วนนี้ยังอยู่ในระหว่างการพัฒนา</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                <button type="submit" form="createTicketForm" class="btn btn-primary">
                    <span class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                    <i class="bi bi-send me-2"></i>ส่งเรื่อง
                </button>
            </div>
        </div>
    </div>
</div>
